<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>Clipzy - Descarga videos f√°cilmente</title>

  <!-- ‚úÖ PWA Meta Tags -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="Clipzy">
  <link rel="apple-touch-icon" href="{{ url_for('static', filename='img/icon.png') }}">

  <meta name="theme-color" content="#22c55e">
  <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">

  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9801535106508814"
     crossorigin="anonymous"></script>

  <link rel="shortcut icon" href="/static/img/icon.png" type="image/x-icon">

  <!-- ‚úÖ SEO META -->
  <meta name="description" content="Clipzy te permite descargar videos de YouTube, TikTok, Pinterest e Instagram. Gratis, r√°pido y en varias calidades.">
  <meta name="keywords" content="descargar videos, youtube downloader, tiktok downloader, descargar reels, instagram reels, pinterest, mp4 gratis, youtube mp4, tiktok mp4, instagram mp4, pinterest mp4, youtube mp3">
  <meta name="author" content="Clipzy">
  <meta property="og:title" content="Clipzy - Descarga videos de YouTube, TikTok, Instagram" />
  <meta property="og:description" content="Herramienta gratuita para descargar cualquier video en segundos." />
  <meta property="og:image" content="https://cdn-icons-png.flaticon.com/512/1384/1384060.png" />
  <meta property="og:url" content="https://clipzy.com" />
  <meta name="twitter:card" content="summary_large_image" />

  <!-- ‚úÖ TAILWIND -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- ‚úÖ Font Awesome Free -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer" />

  <!-- ‚úÖ CUSTOM CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

  <!-- ‚úÖ PARTICLES.JS -->
  <script src="https://cdn.jsdelivr.net/npm/tsparticles@2.12.0/tsparticles.bundle.min.js"></script>
</head>
<body class="bg-gradient-to-br from-green-900 via-green-950 to-black text-white min-h-screen relative overflow-hidden flex flex-col">
  <!-- ‚úÖ Part√≠culas -->
  <div id="tsparticles" class="absolute inset-0 -z-10"></div>

  <!-- ‚úÖ Contenido -->
  <main class="flex flex-col items-center justify-start p-6 text-center animate-fade-in flex-grow">
    <div class="logo-container" style="display: flex; flex-direction: row; justify-content: center; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
      <img src="/static/img/icon.png" alt="Logo de Clipzy" width="20%" class="max-w-[100px]">
      <h1 class="text-5xl sm:text-6xl font-extrabold text-white drop-shadow mb-4">Clipzy</h1>
    </div>

    <p class="text-green-200 mb-6 max-w-xl">
      Descarga videos de <strong>YouTube</strong>, <strong>TikTok</strong>, <strong>Instagram</strong> y <strong>Pinterest</strong> en segundos. 100% Gratis.
    </p>

    <input id="urlInput" type="text" placeholder="Pega el enlace del video..." 
      class="w-full max-w-md p-3 rounded text-black shadow mb-4 focus:outline-none focus:ring-2 focus:ring-green-400 transition" />

    <select id="formatSelect" class="mb-4 w-full max-w-md p-2 rounded text-black shadow">
      <option value="video">üìπ Video (HD)</option>
      <option value="audio">üéµ Solo Audio (MP3)</option>
    </select>

    <button onclick="downloadVideo()" 
      class="bg-green-600 px-6 py-2 rounded hover:bg-green-500 font-semibold transition duration-200 shadow-lg hover:scale-105">
      üì• Descargar
    </button>

    <div class="text-yellow-300 text-sm mt-4 max-w-md bg-yellow-900/50 p-3 rounded">
      ‚ö†Ô∏è Nota: Algunos videos de YouTube pueden no descargarse debido a su sistema de protecci√≥n anti-bots. Prueba con videos p√∫blicos o enlaces de TikTok, Instagram o Pinterest.
    </div>

    <div id="preview" class="mt-6"></div>

    <div id="result" class="mt-6 text-white text-center max-w-md mx-auto"></div>
  </main>

  <div class="my-6 w-full max-w-md mx-auto">
    <!-- C√≥digo de Monetag aqu√≠ (reemplaza con el c√≥digo proporcionado por Monetag) -->
    <div class="bg-green-800 p-4 rounded text-sm text-green-100 text-center">
      üì¢ Anuncio: Descarga sin l√≠mites y sin publicidad al registrarte. ¬°Pr√≥ximamente!
    </div>
    <div class="mt-4 text-center">
      <a href="https://www.paypal.com/donate/?hosted_button_id=QX27VXRQMVENG" target="_blank" class="bg-blue-600 px-4 py-2 rounded hover:bg-blue-500 font-semibold transition duration-200">
        <i class="fa-brands fa-paypal mr-1"></i> Apoya Clipzy con una donaci√≥n
      </a>
    </div>
  </div>

  <!-- Bot√≥n sutil para instalar PWA -->
  <button id="installButton" class="fixed bottom-4 right-4 bg-green-600 px-4 py-2 rounded hover:bg-green-500 font-semibold transition duration-200 shadow-lg hover:scale-105 hidden">
    Instalar Clipzy
  </button>

  <footer class="w-full text-sm text-green-300 text-center mt-auto py-6 bg-black/50">
    ¬© 2025 Clipzy ‚Äî Descargar videos gratis online. By 
    <a href="https://github.com/jhon-henao13" target="_blank" class="text-green-300 hover:text-green-200 transition">
      <i class="fa-brands fa-github mr-1"></i>Estiguar
    </a> | 
    <a href="/terms" class="text-green-300 hover:text-green-200 transition">T√©rminos</a> | 
    <a href="/privacy" class="text-green-300 hover:text-green-200 transition">Privacidad</a>
  </footer>

  <!-- ‚úÖ JS -->
  <script>
    // Registrar Service Worker para PWA
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/static/service-worker.js')
          .then(reg => console.log('Service Worker registrado'))
          .catch(err => console.log('Error al registrar Service Worker: ' + err));
      });
    }

    // L√≥gica para el bot√≥n de instalaci√≥n
    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      document.getElementById('installButton').classList.remove('hidden');
    });

    document.getElementById('installButton').addEventListener('click', async () => {
      document.getElementById('installButton').classList.add('hidden');
      deferredPrompt.prompt();
      const { outcome } = await deferredPrompt.userChoice;
      if (outcome === 'accepted') {
        console.log('PWA instalada');
      }
      deferredPrompt = null;
    });

    async function downloadVideo() {
      const url = document.getElementById('urlInput').value;
      const resultDiv = document.getElementById('result');
      const loader = document.getElementById('loader');

      const format = document.getElementById('formatSelect').value;

      resultDiv.innerHTML = "";
      loader.classList.remove("hidden");

      try {
        const res = await fetch('/api/download', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ url, format })
        });
      
        const data = await res.json();
        loader.classList.add("hidden");

        await fetch('/api/increment', { method: 'POST' });

        if (data.success) {
          const thumbnail = data.thumbnail || '';
          resultDiv.innerHTML = `
            <img src="${thumbnail}" alt="Vista previa" class="w-full max-w-[300px] rounded mx-auto mb-4 shadow-lg border border-green-500">
            <p class="text-green-300 mt-4">üéâ Video listo: <strong>${data.title}</strong></p>
            <a href="${data.download_url}" class="text-green-400 underline mt-2 inline-block hover:text-green-200 transition">‚¨á Descargar ahora</a>`;
        } else {
          resultDiv.innerHTML = `<p class="text-red-400">‚ùå Error: ${data.error}</p>`;
        }
      } catch (err) {
        loader.classList.add("hidden");
        resultDiv.innerHTML = `<p class="text-red-400">‚ùå Error al conectar con el servidor.</p>`;
      }
    }

    // Part√≠culas
    tsParticles.load("tsparticles", {
      fullScreen: { enable: false },
      background: { color: "transparent" },
      particles: {
        number: { value: 50 },
        color: { value: "#22c55e" },
        shape: { type: "circle" },
        opacity: { value: 0.3 },
        size: { value: { min: 1, max: 4 } },
        move: {
          enable: true,
          speed: 1,
          direction: "none",
          outModes: { default: "bounce" }
        }
      },
      interactivity: {
        events: {
          onHover: { enable: true, mode: "repulse" }
        },
        modes: {
          repulse: { distance: 100 }
        }
      }
    });
  </script>

  <!-- Loader oculto -->
  <div id="loader" class="hidden fixed inset-0 flex items-center justify-center bg-black bg-opacity-80 z-50">
    <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-green-400"></div>
  </div>
</body>
</html>